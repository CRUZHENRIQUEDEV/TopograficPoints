<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGO Revisor - Auditoria de OAE</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Extra fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Panel -->
        <main class="main-content">
            <header class="header">
                <div class="header-top">
                    <div class="header-title-section">
                        <h1>üîç OAE Revisor <span id="workTitle" style="color: var(--text-muted); font-size: 0.9rem; font-weight: normal;"></span></h1>
                    </div>
                    <div class="header-controls">
                        <button class="theme-toggle" onclick="toggleTheme()" title="Alternar Modo Claro/Escuro">
                            <span id="themeIcon">üåô</span>
                        </button>
                        <div class="role-switcher">
                            <button class="btn role-btn" data-role="avaliador">Avaliador</button>
                            <button class="btn role-btn" data-role="inspetor">Inspetor</button>
                        </div>
                        <button class="btn btn-secondary" onclick="UI.showWorksModal()" title="Ver obras salvas no banco">üìÇ Gerenciar Obras</button>
                        <button class="btn btn-success" onclick="UI.saveToDatabase()" title="Salvar obra no banco de dados">üíæ Salvar DB</button>
                        <button class="btn btn-primary" onclick="UI.showExportModal()">üì§ Exportar</button>
                    </div>
                </div>

                <div class="tabs-container">
                    <button class="tab-btn active" data-tab="ident">Identifica√ß√£o</button>
                    <button class="tab-btn" data-tab="carac">Caracter√≠sticas Funcionais</button>
                    <button class="tab-btn" data-tab="elem">Elementos Componentes</button>
                    <button class="tab-btn" data-tab="aspect">Aspectos Especiais</button>
                    <button class="tab-btn" data-tab="defic">Defici√™ncias Funcionais</button>
                    <button class="tab-btn" data-tab="rotas">Rotas Alternativas</button>
                    <button class="tab-btn" data-tab="obs">Observa√ß√µes</button>
                    <button class="tab-btn" data-tab="anexos">Arquivos Anexos</button>
                    <button class="tab-btn" data-tab="msgs">Mensagens</button>
                </div>
            </header>

            <div class="tab-content">
                <!-- IDENTIFICA√á√ÉO -->
                <div class="tab-panel active" id="ident">
                    <div class="section">
                        <div class="section-title">üë§ Revisor</div>
                        <div class="form-grid-3">
                            <div class="form-field">
                                <label class="form-label" for="avaliadorNome">Nome do Avaliador</label>
                                <input type="text" class="form-input no-btn" id="avaliadorNome" data-sync="avaliador" placeholder="Seu nome...">
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="obraNome">Obra (Nome)</label>
                                <input type="text" class="form-input no-btn" id="obraNome" data-sync="nome" placeholder="Nome da OAE">
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="obraCodigo">C√≥digo (Ex: OAE-123)</label>
                                <input type="text" class="form-input no-btn" id="obraCodigo" data-sync="codigo" placeholder="000.000">
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">ÔøΩ Dados B√°sicos</div>
                        <div class="form-grid-6">
                            <div class="form-field">
                                <label class="form-label" for="f_ident_orig">Identifica√ß√£o *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_ident_orig" data-field="ident_orig" placeholder="Ponte sobre...">
                                    <button class="error-btn" onclick="UI.openErrorModal('ident_orig', 'Identifica√ß√£o')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_comprimento">Comprimento (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_comprimento" data-field="comprimento">
                                    <button class="error-btn" onclick="UI.openErrorModal('comprimento', 'Comprimento (m)')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_largura">Largura (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_largura" data-field="largura">
                                    <button class="error-btn" onclick="UI.openErrorModal('largura', 'Largura (m)')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_trem_tipo">Trem-Tipo</label>
                                <div class="field-wrapper">
                                    <select class="form-input no-btn" id="f_trem_tipo" data-field="trem_tipo">
                                        <option value="">Selecione</option>
                                        <option value="Classe 24">Classe 24</option>
                                        <option value="Classe 30">Classe 30</option>
                                        <option value="Classe 45">Classe 45</option>
                                    </select>
                                    <button class="error-btn" onclick="UI.openErrorModal('trem_tipo', 'Trem-Tipo')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_ano">Ano de Constru√ß√£o *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_ano" data-field="ano">
                                    <button class="error-btn" onclick="UI.openErrorModal('ano', 'Ano de Constru√ß√£o')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_natureza">Natureza da Estrutura *</label>
                                <div class="field-wrapper">
                                    <select class="form-input no-btn" id="f_natureza" data-field="natureza">
                                        <option value="">Selecione</option>
                                        <option value="Ponte">Ponte</option>
                                        <option value="Viaduto">Viaduto</option>
                                        <option value="Passarela">Passarela</option>
                                        <option value="Ponte M√≥vel">Ponte M√≥vel</option>
                                    </select>
                                    <button class="error-btn" onclick="UI.openErrorModal('natureza', 'Natureza da Estrutura')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üìç Localiza√ß√£o</div>
                        <div class="form-grid-4">
                            <div class="form-field">
                                <label class="form-label">UF *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_uf" data-field="uf">
                                    <button class="error-btn" onclick="UI.openErrorModal('uf', 'UF')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Via *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_via" data-field="via">
                                    <button class="error-btn" onclick="UI.openErrorModal('via', 'Via')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Local na Via (km) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_local_via" data-field="local_via">
                                    <button class="error-btn" onclick="UI.openErrorModal('local_via', 'Local na Via (km)')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Cidade mais pr√≥xima *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_cidade" data-field="cidade">
                                    <button class="error-btn" onclick="UI.openErrorModal('cidade', 'Cidade mais pr√≥xima')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üåç Coordenadas Geogr√°ficas SIRCAS 2000</div>
                        <div class="form-grid-3">
                            <div class="form-field">
                                <label class="form-label">Latitude *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_latitude" data-field="latitude">
                                    <button class="error-btn" onclick="UI.openErrorModal('latitude', 'Latitude')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Longitude *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_longitude" data-field="longitude">
                                    <button class="error-btn" onclick="UI.openErrorModal('longitude', 'Longitude')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Altitude Geom√©trica (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_altitude" data-field="altitude">
                                    <button class="error-btn" onclick="UI.openErrorModal('altitude', 'Altitude')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üî¢ SNV</div>
                        <div class="form-grid-2">
                            <div class="form-field">
                                <label class="form-label">C√≥digo *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_snv_codigo" data-field="snv_codigo">
                                    <button class="error-btn" onclick="UI.openErrorModal('snv_codigo', 'C√≥digo SNV')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Vers√£o *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_snv_versao" data-field="snv_versao">
                                    <button class="error-btn" onclick="UI.openErrorModal('snv_versao', 'Vers√£o SNV')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üè¢ Respons√°veis e Gest√£o</div>
                        <div class="form-grid">
                            <div class="form-field">
                                <label class="form-label">Superintend√™ncia Regional *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_superintendencia" data-field="superintendencia">
                                    <button class="error-btn" onclick="UI.openErrorModal('superintendencia', 'Superintend√™ncia')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Unidade Local *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_unidade_local" data-field="unidade_local">
                                    <button class="error-btn" onclick="UI.openErrorModal('unidade_local', 'Unidade Local')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Administra√ß√£o DNIT? *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_adm_dnit" data-field="adm_dnit">
                                    <button class="error-btn" onclick="UI.openErrorModal('adm_dnit', 'Adm DNIT?')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Administrador *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_administrador" data-field="administrador">
                                    <button class="error-btn" onclick="UI.openErrorModal('administrador', 'Administrador')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Projetista *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_projetista" data-field="projetista">
                                    <button class="error-btn" onclick="UI.openErrorModal('projetista', 'Projetista')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Construtor *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_construtor" data-field="construtor">
                                    <button class="error-btn" onclick="UI.openErrorModal('construtor', 'Construtor')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Localiza√ß√£o do projeto</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_loc_projeto" data-field="loc_projeto">
                                    <button class="error-btn" onclick="UI.openErrorModal('loc_projeto', 'Loc. Projeto')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Loc. de documentos de Constru√ß√£o</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_loc_docs_constr" data-field="loc_docs_constr">
                                    <button class="error-btn" onclick="UI.openErrorModal('loc_docs_constr', 'Loc. Docs Constr.')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Loc. de documentos diversos</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_loc_docs_diversos" data-field="loc_docs_diversos">
                                    <button class="error-btn" onclick="UI.openErrorModal('loc_docs_diversos', 'Loc. Docs Diversos')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CARACTER√çSTICAS FUNCIONAIS -->
                <div class="tab-panel" id="carac">
                    <div class="section">
                        <div class="section-title">üö¶ Caracter√≠sticas e Tr√°fego</div>
                        <div class="form-grid-8">
                            <div class="form-field">
                                <label class="form-label" for="f_atend_snv">Atendimento ao SNV *</label>
                                <div class="field-wrapper">
                                    <select class="form-input no-btn" id="f_atend_snv" data-field="atend_snv">
                                        <option value="">Selecione</option>
                                        <option value="Em servi√ßo">Em servi√ßo</option>
                                        <option value="Demolida">Demolida</option>
                                        <option value="Inconclusa">Inconclusa</option>
                                        <option value="Inserv√≠vel">Inserv√≠vel</option>
                                    </select>
                                    <button class="error-btn" onclick="UI.openErrorModal('atend_snv', 'Atendimento SNV')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_tipo_regiao">Tipo de Regi√£o *</label>
                                <div class="field-wrapper">
                                    <select class="form-input no-btn" id="f_tipo_regiao" data-field="tipo_regiao">
                                        <option value="">Selecione</option>
                                        <option value="Plana">Plana</option>
                                        <option value="Ondulada">Ondulada</option>
                                        <option value="Montanhosa">Montanhosa</option>
                                        <option value="N√£o Informado">N√£o Informado</option>
                                    </select>
                                    <button class="error-btn" onclick="UI.openErrorModal('tipo_regiao', 'Tipo de Regi√£o')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_tipo_tracado">Tipo de Tra√ßado *</label>
                                <div class="field-wrapper">
                                    <select class="form-input no-btn" id="f_tipo_tracado" data-field="tipo_tracado">
                                        <option value="">Selecione</option>
                                        <option value="Tangente">Tangente</option>
                                        <option value="Curva">Curva</option>
                                        <option value="N√£o Informado">N√£o Informado</option>
                                    </select>
                                    <button class="error-btn" onclick="UI.openErrorModal('tipo_tracado', 'Tipo de Tra√ßado')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_rampa">Rampa M√°xima (%)</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_rampa" data-field="rampa">
                                    <button class="error-btn" onclick="UI.openErrorModal('rampa', 'Rampa M√°xima')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_raio">Raio da Curva (m)</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_raio" data-field="raio">
                                    <button class="error-btn" onclick="UI.openErrorModal('raio', 'Raio da Curva')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_vmda">VMDa *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_vmda" data-field="vmda">
                                    <button class="error-btn" onclick="UI.openErrorModal('vmda', 'VMDa')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_vmdc">VMDc *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_vmdc" data-field="vmdc">
                                    <button class="error-btn" onclick="UI.openErrorModal('vmdc', 'VMDc')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field" style="justify-content: flex-end; padding-bottom: 2px;">
                                <button class="btn btn-primary" id="btn_enriquecer_vmd" style="height: 32px; font-size: 11px; white-space: nowrap;">Enriquecer Vmds</button>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üìè Dimens√µes</div>
                        <div class="form-grid-10">
                            <div class="form-field">
                                <label class="form-label" for="f_faixas">N√∫mero de Faixas *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_faixas" data-field="faixas">
                                    <button class="error-btn" onclick="UI.openErrorModal('faixas', 'Num. Faixas')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_larg_faixa">Largura da Faixa (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_larg_faixa" data-field="larg_faixa">
                                    <button class="error-btn" onclick="UI.openErrorModal('larg_faixa', 'Larg. Faixa')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_acost_dir">Acostamento Dir. (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_acost_dir" data-field="acost_dir">
                                    <button class="error-btn" onclick="UI.openErrorModal('acost_dir', 'Acost. Direito')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_acost_esq">Acostamento Esq. (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_acost_esq" data-field="acost_esq">
                                    <button class="error-btn" onclick="UI.openErrorModal('acost_esq', 'Acost. Esquerdo')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_calc_dir">Cal√ßada Dir. (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_calc_dir" data-field="calc_dir">
                                    <button class="error-btn" onclick="UI.openErrorModal('calc_dir', 'Cal√ßada Direita')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_calc_esq">Cal√ßada Esq. (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_calc_esq" data-field="calc_esq">
                                    <button class="error-btn" onclick="UI.openErrorModal('calc_esq', 'Cal√ßada Esquerda')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_gab_hor">Gabarito Horiz. (m)</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_gab_hor" data-field="gab_hor">
                                    <button class="error-btn" onclick="UI.openErrorModal('gab_hor', 'Gabarito Horiz.')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_gab_ver">Gabarito Vert. (m)</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_gab_ver" data-field="gab_ver">
                                    <button class="error-btn" onclick="UI.openErrorModal('gab_ver', 'Gabarito Vert.')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_larg_pista_antes">Larg. pista antes (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_larg_pista_antes" data-field="larg_pista_antes">
                                    <button class="error-btn" onclick="UI.openErrorModal('larg_pista_antes', 'Larg. Pista Antes')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label" for="f_larg_pista_depois">Larg. pista depois (m) *</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_larg_pista_depois" data-field="larg_pista_depois">
                                    <button class="error-btn" onclick="UI.openErrorModal('larg_pista_depois', 'Larg. Pista Depois')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üß± Tramos da OAE</div>
                        <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; background: var(--bg-tertiary); padding: 15px; border-radius: var(--radius-md);">
                            <label style="font-weight: 700; color: var(--primary);">N√∫mero de Tramos:</label>
                            <input type="number" id="numTramosGlobal" min="1" max="50" value="1" style="width: 70px; padding: 5px; border-radius: 4px; border: 1px solid var(--border);">
                            <span style="font-size: 0.8rem; color: var(--text-muted);">+ Tramo Complementar (C)</span>
                        </div>
                        <div id="tramosCaracContainer"></div>
                    </div>
                </div>

                <!-- ELEMENTOS COMPONENTES -->
                <div class="tab-panel" id="elem">
                    <div class="section evaluator-only">
                        <div class="section-title">‚ûï Adicionar Inconsist√™ncia em Elemento</div>
                        <div class="form-grid">
                            <div class="form-field">
                                <label class="form-label">Tramo</label>
                                <select class="form-input no-btn" id="bulkTramo"></select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Filtrar por Regi√£o</label>
                                <select class="form-input no-btn" id="bulkRegiaoFiltro" onchange="UI.filterElementsByRegion()">
                                    <option value="">Todas as Regi√µes</option>
                                    <option value="Apoio">Apoio</option>
                                    <option value="Superestrutura">Superestrutura</option>
                                    <option value="Transi√ß√£o">Transi√ß√£o</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Fam√≠lia de Elemento</label>
                                <select class="form-input no-btn" id="bulkFamilia" style="max-height: 200px;"></select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Inconsist√™ncia</label>
                                <select class="form-input no-btn" id="bulkErro"></select>
                            </div>
                            <div class="form-field" style="grid-column: span 2;">
                                <label class="form-label">Observa√ß√£o / Nota</label>
                                <textarea class="form-input no-btn" id="bulkObs" style="height: 100px;"></textarea>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="UI.addBulkElements()">Apontar Elemento(s)</button>
                    </div>

                    <div id="elementsContainer"></div>
                </div>

                <!-- ASPECTOS ESPECIAIS -->
                <div class="tab-panel" id="aspect">
                    <div class="section">
                        <div class="section-title">üíé Aspectos Especiais</div>
                        <!-- Checkbox list of aspects rendered by JS -->
                        <div id="aspectosList" class="form-grid" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));"></div>
                    </div>
                </div>

                <!-- DEFICI√äNCIAS FUNCIONAIS -->
                <div class="tab-panel" id="defic">
                    <div class="section">
                        <div class="section-title">‚ö†Ô∏è Defici√™ncias Funcionais</div>
                        <div class="form-field">
                            <label class="form-label">Relato de Defici√™ncias</label>
                            <div class="field-wrapper">
                                <textarea class="form-input" id="f_deficiencias" data-field="deficiencias" style="height: 200px;"></textarea>
                                <button class="error-btn" onclick="UI.openErrorModal('deficiencias', 'Defici√™ncias Funcionais')">‚ö†</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ROTAS ALTERNATIVAS -->
                <div class="tab-panel" id="rotas">
                    <div class="section">
                        <div class="section-title">üîÑ Rotas Alternativas</div>
                        <div class="form-grid">
                            <div class="form-field" style="grid-column: span 2;">
                                <label class="form-label">Rota Sugerida</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_rota" data-field="rota">
                                    <button class="error-btn" onclick="UI.openErrorModal('rota', 'Rota Alternativa')">‚ö†</button>
                                </div>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Acr√©scimo de KM</label>
                                <div class="field-wrapper">
                                    <input type="text" class="form-input" id="f_rota_km" data-field="rota_km">
                                    <button class="error-btn" onclick="UI.openErrorModal('rota_km', 'Acr√©scimo KM')">‚ö†</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OBSERVA√á√ïES -->
                <div class="tab-panel" id="obs">
                    <div class="section">
                        <div class="section-title">üìù Observa√ß√µes Gerais</div>
                        <div class="form-field">
                            <label class="form-label">Texto das Observa√ß√µes</label>
                            <div class="field-wrapper">
                                <textarea class="form-input" id="f_observacoes" data-field="observacoes" style="height: 300px;"></textarea>
                                <button class="error-btn" onclick="UI.openErrorModal('observacoes', 'Observa√ß√µes')">‚ö†</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ARQUIVOS ANEXOS -->
                <div class="tab-panel" id="anexos">
                    <div class="section evaluator-only">
                        <div class="section-title">üìé Apontar Erro em Anexo / Foto</div>
                        <div class="form-grid">
                            <div class="form-field">
                                <label class="form-label">Nome do Arquivo (Ex: F-01)</label>
                                <input type="text" class="form-input no-btn" id="anexoNome">
                            </div>
                            <div class="form-field">
                                <label class="form-label">Tipo de Arquivo</label>
                                <select class="form-input no-btn" id="anexoTipo">
                                    <option>Foto</option>
                                    <option>PDF (Relat√≥rio/Croqui)</option>
                                    <option>DWG</option>
                                    <option>KML</option>
                                    <option>Outro</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Tipo de Inconsist√™ncia</label>
                                <select class="form-input no-btn" id="anexoTipoErro">
                                    <option>Legenda divergente do conte√∫do</option>
                                    <option>Qualidade insuficiente</option>
                                    <option>Foto duplicada</option>
                                    <option>N√£o corresponde ao local</option>
                                    <option>Falta arquivo obrigat√≥rio</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Observa√ß√£o</label>
                                <input type="text" class="form-input no-btn" id="anexoObs">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="UI.addAnexoError()">Adicionar Erro de Anexo</button>
                    </div>
                    <div id="attachmentsContainer" style="margin-top: 20px;"></div>
                </div>

                <!-- MENSAGENS -->
                <div class="tab-panel" id="msgs">
                    <!-- Status Bar -->
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">TOTAL DE INCONSIST√äNCIAS</div>
                            <div id="msgsTotalCount" style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">0</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">PENDENTES</div>
                            <div id="msgsPendingCount" style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">0</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">CORRIGIDAS</div>
                            <div id="msgsCompletedCount" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">0</div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üí¨ Canal de Comunica√ß√£o</div>
                        <div class="evaluator-only">
                            <div class="form-field" style="margin-bottom: 20px;">
                                <label class="form-label">Escrever Mensagem</label>
                                <textarea class="form-input no-btn" id="novaMensagem" style="height: 100px;" placeholder="D√∫vida ou esclarecimento sobre a auditoria..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="UI.addMensagem()">Enviar Mensagem</button>
                        </div>

                        <div id="mensagensContainer" style="margin-top: 30px;"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Sidebar Report -->
        <aside class="sidebar-report">
            <div class="sidebar-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 700; font-size: 0.9rem;">Relat√≥rio em Tempo Real</span>
                    <span id="totalErrorBadge" style="background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: 700;">0</span>
                </div>
            </div>
            <textarea id="reportText" class="report-textarea" readonly></textarea>
            <div style="padding: 20px; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px;">
                <button class="btn btn-primary" style="justify-content: center;" onclick="UI.copyReport()">üìã Copiar Relat√≥rio</button>
                <button class="btn btn-secondary" style="justify-content: center;" onclick="UI.clearAll()">üóëÔ∏è Limpar Tudo</button>
            </div>
        </aside>
    </div>

    <!-- Error Modal -->
    <div class="modal-backdrop" id="errorModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Apontar Inconsist√™ncia</h3>
                <button class="modal-close" onclick="UI.closeErrorModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic Content -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="btnRemoveError" onclick="UI.clearFieldError()">Limpar Erro</button>
                <button class="btn btn-secondary" onclick="UI.closeErrorModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="UI.applyError()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">Mensagem salva com sucesso!</div>

    <!-- Scripts -->
    <script src="js/state.js"></script>
    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/autosave.js"></script>
    <script src="js/importExport.js"></script>

    <script>
        // Init logic
        document.addEventListener('DOMContentLoaded', async () => {
            await DB.init();
            
            // Try to load initial data if code exists (e.g. from state or DOM)
            Sync.init(); // Starts with DOM values

            if (appState.work.codigo) {
                const saved = await DB.loadObra(appState.work.codigo);
                if (saved) {
                    Sync.syncFromDB(saved);
                    console.log('Loadedobra from DB on init:', appState.work.codigo);
                }
            }

            UI.init();
            AutoSave.init();
            
            // Final render
            UI.renderAll();
        });

        // Theme Toggle Logic
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', target);
            document.getElementById('themeIcon').textContent = target === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('oae-revisor-theme', target);
        }

        // Restore theme
        const savedTheme = localStorage.getItem('oae-revisor-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    </script>
</body>
</html>
