const fs=require("fs");const path=require("path");const obfuscator=require("javascript-obfuscator");function ensureDirSync(p){if(!fs.existsSync(p)){fs.mkdirSync(p,{recursive:true});}}function readFileSyncSafe(p){return fs.readFileSync(p,"utf8");}function writeFileSyncSafe(p,c){fs.writeFileSync(p,c,"utf8");}function walkSrcFiles(root){const items=[];function walk(current){const st=fs.statSync(current);if(st.isDirectory()){const base=path.basename(current);if(base==="src"){const out=path.join(path.dirname(current),"dist");items.push([current,out]);}else{fs.readdirSync(current).forEach(n=>walk(path.join(current,n)));}}}walk(root);return items;}function collectJsFiles(srcDir){return fs.readdirSync(srcDir).filter(f=>f.endsWith(".js")).map(f=>path.join(srcDir,f));}function obfuscateContent(code){const result=obfuscator.obfuscate(code,{compact:true,controlFlowFlattening:true,deadCodeInjection:true,deadCodeInjectionThreshold:0.05,stringArray:true,stringArrayRotate:true,stringArrayEncoding:["rc4"],renameGlobals:false,selfDefending:true,debugProtection:true,debugProtectionInterval:4000,splitStrings:true,splitStringsChunkLength:6,identifierNamesGenerator:"hexadecimal",transformObjectKeys:true,disableConsoleOutput:true});return result.getObfuscatedCode();}function processPair(srcDir,outDir){ensureDirSync(outDir);const files=collectJsFiles(srcDir);files.forEach(inFile=>{const base=path.basename(inFile).replace(/\.js$/,"");const outFile=path.join(outDir,`${base}.obf.js`);const code=readFileSyncSafe(inFile);const obf=obfuscateContent(code);writeFileSyncSafe(outFile,obf);});}function main(){const args=process.argv.slice(2);const root=path.resolve(process.cwd(),"js","tools");if(args.length===2){const srcDir=path.resolve(process.cwd(),args[0]);const outDir=path.resolve(process.cwd(),args[1]);processPair(srcDir,outDir);return;}const pairs=walkSrcFiles(root);pairs.forEach(([srcDir,outDir])=>processPair(srcDir,outDir));}main();
