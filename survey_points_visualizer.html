<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analisador de Eleva√ß√£o e Inclina√ß√£o de Tabuleiros de Ponte</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      
      .input-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .csv-input {
        display: flex;
        flex-direction: column;
      }
      
      .csv-input label {
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }
      
      textarea {
        width: 100%;
        height: 200px;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        resize: vertical;
      }
      
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      
      button:hover {
        background: #0056b3;
      }
      
      .controls {
        text-align: center;
        margin: 20px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .zoom-controls {
        display: flex;
        align-items: center;
        background: #f8f9fa;
        padding: 8px 15px;
        border-radius: 25px;
        border: 1px solid #dee2e6;
        margin-left: 20px;
      }
      
      @media (max-width: 768px) {
        .controls {
          flex-direction: column;
          gap: 15px;
        }
        
        .zoom-controls {
          margin-left: 0;
          width: 100%;
          justify-content: center;
        }
      }
      
      .zoom-controls button {
        margin: 0 5px;
        padding: 6px 10px;
        font-size: 14px;
        min-width: 40px;
      }
      
      #zoomLevel {
        margin: 0 15px;
        font-weight: bold;
        color: #495057;
        font-size: 14px;
        min-width: 80px;
        text-align: center;
      }
      
      .visualization {
        border: 2px solid #ddd;
        border-radius: 10px;
        background: white;
        min-height: 500px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
      }
      
      #canvas {
        border: 1px solid #ccc;
        background: #fafafa;
      }
      
      .info-panel {
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      
      .distance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 15px;
      }
      
      .distance-card {
        background: white;
        padding: 12px;
        border-radius: 5px;
        border: 1px solid #ddd;
        text-align: center;
        transition: transform 0.2s;
      }
      
      .distance-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }
      
      .section-divider {
        grid-column: 1 / -1;
        height: 1px;
        background: linear-gradient(to right, transparent, #ddd, transparent);
        margin: 15px 0;
      }
      
      .distance-value {
        font-size: 18px;
        font-weight: bold;
        color: #007bff;
      }
      
      .elevation-value {
        font-size: 16px;
        font-weight: bold;
      }
      
      .inclination-value {
        font-size: 14px;
        font-weight: bold;
      }
      
      .cross-distance-card {
        background: linear-gradient(135deg, #fff3e0, #e8f5e8);
        border: 2px solid #ff9800;
      }
      
      .cross-distance-value {
        color: #ff9800;
      }
      
      .elevation-analysis-card {
        background: linear-gradient(135deg, #e8f5e8, #f3e5f5);
        border: 2px solid #4caf50;
      }
      
      .warning-card {
        background: linear-gradient(135deg, #fff3e0, #ffebee);
        border: 2px solid #ff5722;
      }
      
      .good-card {
        background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
        border: 2px solid #4caf50;
      }
      
      .error {
        color: #dc3545;
        background: #f8d7da;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
      }
      
      .csv-section {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        background: #fafafa;
      }
      
      .section-title {
        color: #007bff;
        font-size: 18px;
        margin-bottom: 10px;
        font-weight: bold;
      }
      
      .example-buttons {
        margin-top: 10px;
      }
      
      .example-btn {
        background: #28a745;
        font-size: 14px;
        padding: 8px 16px;
      }
      
      .example-btn:hover {
        background: #218838;
      }
      
      .cross-section {
        background: linear-gradient(135deg, #fff3e0, #e8f5e8);
        border: 2px solid #ff9800;
        margin: 20px 0 10px 0;
        grid-column: 1 / -1;
        text-align: center;
      }
      
      .structure-section {
        background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        border: 2px solid #9c27b0;
        margin: 15px 0 5px 0;
        grid-column: 1 / -1;
        text-align: center;
      }
      
      .elevation-section {
        background: linear-gradient(135deg, #e8f5e8, #f3e5f5);
        border: 2px solid #4caf50;
        margin: 15px 0 5px 0;
        grid-column: 1 / -1;
        text-align: center;
      }
      
      .legend {
        margin: 10px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        font-size: 12px;
      }
      
      .legend-item {
        display: inline-block;
        margin: 0 10px;
      }
      
      .legend-color {
        display: inline-block;
        width: 15px;
        height: 15px;
        border-radius: 3px;
        margin-right: 5px;
        vertical-align: middle;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üåâ Analisador de Eleva√ß√£o e Inclina√ß√£o de Tabuleiros de Ponte</h1>

      <div class="input-section">
        <!-- CSV 1 -->
        <div class="csv-section">
          <div class="section-title">üìç CSV 1 - Primeira Estrutura</div>
          <textarea
            id="csvData1"
            placeholder="Cole aqui os dados do primeiro CSV..."
          ></textarea>
          <div class="example-buttons">
            <button onclick="loadExample1()" class="example-btn">
              üìù Exemplo CSV 1
            </button>
          </div>
        </div>

        <!-- CSV 2 -->
        <div class="csv-section">
          <div class="section-title">üìç CSV 2 - Segunda Estrutura</div>
          <textarea
            id="csvData2"
            placeholder="Cole aqui os dados do segundo CSV (opcional)..."
          ></textarea>
          <div class="example-buttons">
            <button onclick="loadExample2()" class="example-btn">
              üìù Exemplo CSV 2
            </button>
          </div>
        </div>
      </div>

      <div class="controls">
        <button onclick="processData()">üîÑ Processar e Visualizar</button>
        <button onclick="clearAll()" style="background: #dc3545;">
          üóëÔ∏è Limpar Tudo
        </button>
        <div class="zoom-controls">
          <button onclick="zoomOut()" style="background: #6c757d;">
            üîç-
          </button>
          <span id="zoomLevel">Zoom: 200%</span>
          <button onclick="zoomIn()" style="background: #6c757d;">
            üîç+
          </button>
          <button onclick="resetZoom()" style="background: #17a2b8; margin-left: 10px;">
            ‚Üª Reset
          </button>
        </div>
      </div>

      <div class="legend">
        <strong>üé® Legenda de Cores (Eleva√ß√£o):</strong>
        <div class="legend-item">
          <span class="legend-color" style="background: #4caf50;"></span>
          <span>Eleva√ß√£o Baixa</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background: #ffeb3b;"></span>
          <span>Eleva√ß√£o M√©dia</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background: #ff9800;"></span>
          <span>Eleva√ß√£o Alta</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background: #f44336;"></span>
          <span>Eleva√ß√£o Muito Alta</span>
        </div>
      </div>

      <div class="visualization">
        <canvas id="canvas" width="1100" height="800"></canvas>
      </div>

      <div id="infoPanel" class="info-panel" style="display: none">
        <h3>üìä Medidas e An√°lises das Estruturas</h3>
        <div id="distanceInfo" class="distance-grid"></div>
        
        <!-- Resumo Executivo -->
        <div id="executiveSummary" style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 8px; border-left: 4px solid #007bff;"></div>
      </div>

      <div id="errorMsg"></div>
    </div>

    <script>
      // Vari√°veis globais para zoom e dados
      let currentZoom = 2.0; // Zoom padr√£o 200%
      let currentPoints1 = {};
      let currentPoints2 = {};
      
      function loadExample1() {
        const exampleData1 = `Name,Code,Lat,Long,H_GEO,H_ORTO,x,y
"05",JUSESQ,-9.8976347800,-36.4167136000,188.80925,197.1262098000,-36.4167136710,-9.8976347823
"06",JUSDIR,-9.8975431900,-36.4167583000,189.01495,197.3316011000,-36.4167583598,-9.8975431976
P-04,LD_FINAL_OAE,-9.8974730300,-36.4166092000,188.93670,197.2531865000,-36.4166092614,-9.8974730373
P-03,LE_FINAL_OAE,-9.8975631400,-36.4165642000,188.78735,197.1041407000,-36.4165642134,-9.8975631483
P-01,LE_INICIO_OAE,-9.8975029500,-36.4164419000,188.77963,197.0962773000,-36.4164419708,-9.8975029554
P-02,LD_INICIO_OAE,-9.8974121600,-36.4164865000,188.99719,197.3135310000,-36.4164865650,-9.8974121660
"07",MONDIR,-9.8972934700,-36.4162403000,188.86808,197.1841401000,-36.4162403921,-9.8972934728
"08",MONESQ,-9.8973829800,-36.4161912000,188.66533,196.9816940000,-36.4161912260,-9.8973829816`;

        document.getElementById('csvData1').value = exampleData1;
        processData();
      }

      function loadExample2() {
        const exampleData2 = `Name,Code,Lat,Long,H_GEO,H_ORTO,x,y
"09",JUSESQ,-9.8970347800,-36.4160136000,188.80925,197.1262098000,-36.4160136710,-9.8970347823
"10",JUSDIR,-9.8969431900,-36.4160583000,189.01495,197.3316011000,-36.4160583598,-9.8969431976
P-08,LD_FINAL_OAE,-9.8968730300,-36.4159092000,188.93670,197.2531865000,-36.4159092614,-9.8968730373
P-07,LE_FINAL_OAE,-9.8969631400,-36.4158642000,188.78735,197.1041407000,-36.4158642134,-9.8969631483
P-05,LE_INICIO_OAE,-9.8969029500,-36.4157419000,188.77963,197.0962773000,-36.4157419708,-9.8969029554
P-06,LD_INICIO_OAE,-9.8968121600,-36.4157865000,188.99719,197.3135310000,-36.4157865650,-9.8968121660
"11",MONDIR,-9.8966934700,-36.4155403000,188.86808,197.1841401000,-36.4155403921,-9.8966934728
"12",MONESQ,-9.8967829800,-36.4154912000,188.66533,196.9816940000,-36.4154912260,-9.8967829816`;

        document.getElementById('csvData2').value = exampleData2;
        processData();
      }

      // Fun√ß√µes de zoom
      function zoomIn() {
        currentZoom = Math.min(currentZoom * 1.2, 3.0);
        updateZoomDisplay();
        redrawVisualization();
      }
      
      function zoomOut() {
        currentZoom = Math.max(currentZoom / 1.2, 0.3);
        updateZoomDisplay();
        redrawVisualization();
      }
      
      function resetZoom() {
        currentZoom = 2.0; // Reset para zoom padr√£o 200%
        updateZoomDisplay();
        redrawVisualization();
      }
      
      function updateZoomDisplay() {
        const zoomPercent = Math.round(currentZoom * 100);
        document.getElementById('zoomLevel').textContent = `Zoom: ${zoomPercent}%`;
      }
      
      function redrawVisualization() {
        if (Object.keys(currentPoints1).length > 0) {
          drawVisualization(currentPoints1, currentPoints2);
        }
      }

      function clearAll() {
        document.getElementById('csvData1').value = '';
        document.getElementById('csvData2').value = '';
        document.getElementById('infoPanel').style.display = 'none';
        document.getElementById('errorMsg').innerHTML = '';
        
        // Limpar dados de zoom
        currentZoom = 2.0; // Zoom padr√£o 200%
        currentPoints1 = {};
        currentPoints2 = {};
        updateZoomDisplay();
        
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      function parseCSV(csvText) {
        if (!csvText.trim()) return [];
        
        const lines = csvText.trim().split("\n");
        const firstLine = lines[0];
        let headers;
        let dataStartIndex = 0;

        if (
          firstLine.includes("Name") ||
          firstLine.includes("Code") ||
          firstLine.includes("Lat") ||
          firstLine.includes("Long") ||
          firstLine.includes("x") ||
          firstLine.includes("y")
        ) {
          headers = lines[0].split(",").map((h) => h.trim().replace(/"/g, ''));
          dataStartIndex = 1;
        } else {
          headers = ["0", "1", "2", "3", "4"];
          dataStartIndex = 0;
        }

        const data = [];
        for (let i = dataStartIndex; i < lines.length; i++) {
          if (lines[i].trim() === "") continue;

          const values = lines[i].split(",");
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index]?.trim().replace(/"/g, '') || "";
          });
          data.push(row);
        }
        return data;
      }

      function calculateDistance(point1, point2) {
        const x1 = parseFloat(point1.x);
        const y1 = parseFloat(point1.y);
        const x2 = parseFloat(point2.x);
        const y2 = parseFloat(point2.y);

        const deltaX = x2 - x1;
        const deltaY = y2 - y1;

        let distance;

        if ((point1.coordType === 'UTM' && point2.coordType === 'UTM') || 
            (point1.coordType === 'PLANE' && point2.coordType === 'PLANE')) {
          distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        } 
        else if ((point1.coordType === 'GEO' && point2.coordType === 'GEO') ||
                 (Math.abs(x1) < 180 && Math.abs(y1) < 90 && Math.abs(x2) < 180 && Math.abs(y2) < 90)) {
          const lat1Rad = (y1 * Math.PI) / 180;
          const lat2Rad = (y2 * Math.PI) / 180;
          const avgLatRad = (lat1Rad + lat2Rad) / 2;

          const deltaLatM = deltaY * 111320;
          const deltaLonM = deltaX * 111320 * Math.cos(avgLatRad);

          distance = Math.sqrt(deltaLatM * deltaLatM + deltaLonM * deltaLonM);
        }
        else {
          distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        }

        return distance;
      }

      // Nova fun√ß√£o para calcular diferen√ßa de eleva√ß√£o
      function calculateElevationDifference(point1, point2) {
        const elev1 = parseFloat(point1.elevation);
        const elev2 = parseFloat(point2.elevation);
        return elev2 - elev1; // Positivo se point2 √© mais alto
      }

      // Nova fun√ß√£o para calcular inclina√ß√£o
      function calculateInclination(point1, point2) {
        const distance = calculateDistance(point1, point2);
        const elevationDiff = calculateElevationDifference(point1, point2);
        
        if (distance === 0) return { percentage: 0, degrees: 0, ratio: "0:1" };
        
        const percentage = (Math.abs(elevationDiff) / distance) * 100;
        const degrees = Math.atan(Math.abs(elevationDiff) / distance) * (180 / Math.PI);
        const ratio = `1:${(distance / Math.abs(elevationDiff)).toFixed(1)}`;
        
        return { 
          percentage: percentage, 
          degrees: degrees, 
          ratio: ratio,
          direction: elevationDiff > 0 ? "‚ÜóÔ∏è Subida" : elevationDiff < 0 ? "‚ÜòÔ∏è Descida" : "‚û°Ô∏è Nivelado"
        };
      }

      // Fun√ß√£o para obter cor baseada na eleva√ß√£o
      function getElevationColor(elevation, minElev, maxElev) {
        const normalized = (elevation - minElev) / (maxElev - minElev);
        
        if (normalized < 0.25) return "#4caf50"; // Verde - baixo
        else if (normalized < 0.5) return "#ffeb3b"; // Amarelo - m√©dio
        else if (normalized < 0.75) return "#ff9800"; // Laranja - alto
        else return "#f44336"; // Vermelho - muito alto
      }

      function findPoints(data) {
        const points = {};
        data.forEach((row, index) => {
          const name = row.Name || row.Code || row["4"] || "";
          const code = row.Code || row.Name || row["4"] || "";

          if (
            code.includes("LD_INICIO_OAE") ||
            code.includes("LE_INICIO_OAE") ||
            code.includes("LD_FINAL_OAE") ||
            code.includes("LE_FINAL_OAE") ||
            name.includes("LD_INICIO_OAE") ||
            name.includes("LE_INICIO_OAE") ||
            name.includes("LD_FINAL_OAE") ||
            name.includes("LE_FINAL_OAE")
          ) {
            let xCoord, yCoord, elevation;

            if (row.Northing && row.Easting) {
              xCoord = parseFloat(row.Easting);
              yCoord = parseFloat(row.Northing);
            }
            else if (row.x && row.y) {
              xCoord = parseFloat(row.x);
              yCoord = parseFloat(row.y);
            }
            else if (row.Long && row.Lat) {
              xCoord = parseFloat(row.Long);
              yCoord = parseFloat(row.Lat);
            }

            elevation = parseFloat(row.Elevation) || parseFloat(row.H_GEO) || parseFloat(row.H_ORTO) || parseFloat(row.Altura) || parseFloat(row.Z) || 0;

            const pointData = {
              x: xCoord,
              y: yCoord,
              elevation: elevation,
              lat: parseFloat(row.Lat) || yCoord,
              long: parseFloat(row.Long) || xCoord,
              easting: parseFloat(row.Easting) || xCoord,
              northing: parseFloat(row.Northing) || yCoord,
              name: name || code,
              code: code || name,
              originalName: name,
              originalCode: code,
              coordType: row.Northing && row.Easting ? 'UTM' : (Math.abs(xCoord) < 180 && Math.abs(yCoord) < 90 ? 'GEO' : 'PLANE')
            };
            
            if (code) points[code] = pointData;
            if (name && name !== code) points[name] = pointData;
          }
        });
        
        return points;
      }

      function drawVisualization(points1, points2 = {}) {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const allPoints = {...points1, ...points2};
        const coords = Object.values(allPoints);
        if (coords.length === 0) return;

        const minX = Math.min(...coords.map((p) => p.x));
        const maxX = Math.max(...coords.map((p) => p.x));
        const minY = Math.min(...coords.map((p) => p.y));
        const maxY = Math.max(...coords.map((p) => p.y));
        
        // Para cores de eleva√ß√£o
        const minElev = Math.min(...coords.map((p) => p.elevation));
        const maxElev = Math.max(...coords.map((p) => p.elevation));

        const margin = 120;
        const scaleX = (canvas.width - 2 * margin) / (maxX - minX);
        const scaleY = (canvas.height - 2 * margin) / (maxY - minY);
        const scaleFactor = Object.keys(points2).length > 0 ? 0.15 : 0.25;
        const scale = Math.min(scaleX, scaleY) * scaleFactor * currentZoom;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const dataWidth = (maxX - minX) * scale;
        const dataHeight = (maxY - minY) * scale;

        function toCanvasCoords(point) {
          return {
            x: centerX - dataWidth / 2 + (point.x - minX) * scale,
            y: centerY + dataHeight / 2 - (point.y - minY) * scale,
          };
        }

        function drawStructure(points, color, label) {
          const ldInicio = Object.values(points).find(p => 
            p.code.includes("LD_INICIO_OAE") || 
            p.name.includes("LD_INICIO_OAE") ||
            p.originalCode.includes("LD_INICIO_OAE") ||
            p.originalName.includes("LD_INICIO_OAE")
          );
          
          const leInicio = Object.values(points).find(p => 
            p.code.includes("LE_INICIO_OAE") || 
            p.name.includes("LE_INICIO_OAE") ||
            p.originalCode.includes("LE_INICIO_OAE") ||
            p.originalName.includes("LE_INICIO_OAE")
          );
          
          const ldFinal = Object.values(points).find(p => 
            p.code.includes("LD_FINAL_OAE") || 
            p.name.includes("LD_FINAL_OAE") ||
            p.originalCode.includes("LD_FINAL_OAE") ||
            p.originalName.includes("LD_FINAL_OAE")
          );
          
          const leFinal = Object.values(points).find(p => 
            p.code.includes("LE_FINAL_OAE") || 
            p.name.includes("LE_FINAL_OAE") ||
            p.originalCode.includes("LE_FINAL_OAE") ||
            p.originalName.includes("LE_FINAL_OAE")
          );

          if (!ldInicio || !leInicio || !ldFinal || !leFinal) {
            return null;
          }

          const ldInicioCanvas = toCanvasCoords(ldInicio);
          const leInicioCanvas = toCanvasCoords(leInicio);
          const ldFinalCanvas = toCanvasCoords(ldFinal);
          const leFinalCanvas = toCanvasCoords(leFinal);

          // Desenhar ret√¢ngulo
          ctx.strokeStyle = color;
          const rectLineWidth = Math.max(1, 1.5 * currentZoom);
          ctx.lineWidth = rectLineWidth;
          ctx.beginPath();
          ctx.moveTo(ldInicioCanvas.x, ldInicioCanvas.y);
          ctx.lineTo(leInicioCanvas.x, leInicioCanvas.y);
          ctx.lineTo(leFinalCanvas.x, leFinalCanvas.y);
          ctx.lineTo(ldFinalCanvas.x, ldFinalCanvas.y);
          ctx.closePath();
          ctx.stroke();

          // Preencher ret√¢ngulo com transpar√™ncia
          const alpha = color === "#007bff" ? "0.08" : "0.04";
          ctx.fillStyle = color.replace("rgb", "rgba").replace(")", `, ${alpha})`);
          if (color.startsWith("#")) {
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);
            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
          }
          ctx.fill();

          // Desenhar pontos com cores baseadas na eleva√ß√£o
          const pointData = [
            { point: ldInicio, canvas: ldInicioCanvas, baseColor: "#dc3545", label: `LD IN√çCIO ${label}` },
            { point: leInicio, canvas: leInicioCanvas, baseColor: "#28a745", label: `LE IN√çCIO ${label}` },
            { point: ldFinal, canvas: ldFinalCanvas, baseColor: "#dc3545", label: `LD FINAL ${label}` },
            { point: leFinal, canvas: leFinalCanvas, baseColor: "#28a745", label: `LE FINAL ${label}` },
          ];

          pointData.forEach(({ point, canvas, baseColor, label }) => {
            // Cor baseada na eleva√ß√£o
            const elevationColor = getElevationColor(point.elevation, minElev, maxElev);
            
            // Desenhar c√≠rculo externo (base)
            ctx.fillStyle = baseColor;
            ctx.beginPath();
            const pointRadius = Math.max(3, 4 * currentZoom);
            ctx.arc(canvas.x, canvas.y, pointRadius, 0, 2 * Math.PI);
            ctx.fill();
            
            // Desenhar c√≠rculo interno (eleva√ß√£o)
            ctx.fillStyle = elevationColor;
            ctx.beginPath();
            ctx.arc(canvas.x, canvas.y, pointRadius * 0.7, 0, 2 * Math.PI);
            ctx.fill();

            // Label do ponto
            ctx.fillStyle = "#333";
            const fontSize = Math.max(6, 8 * currentZoom);
            ctx.font = `${fontSize}px Arial`;
            ctx.textAlign = "center";
            const labelOffset = Math.max(8, 12 * currentZoom);
            ctx.fillText(label, canvas.x, canvas.y - labelOffset);
            
            // Mostrar eleva√ß√£o
            ctx.fillStyle = "#666";
            const elevFontSize = Math.max(5, 7 * currentZoom);
            ctx.font = `${elevFontSize}px Arial`;
            ctx.fillText(`${point.elevation.toFixed(3)}m`, canvas.x, canvas.y + labelOffset + 8);
          });

          return { ldInicio, leInicio, ldFinal, leFinal };
        }

        const struct1 = drawStructure(points1, "#007bff", "(1)");
        const struct2 = Object.keys(points2).length > 0 ? drawStructure(points2, "#e91e63", "(2)") : null;

        // Desenhar linha de conex√£o
        if (struct1 && struct2) {
          const leInicio1Canvas = toCanvasCoords(struct1.leInicio);
          const ldInicio2Canvas = toCanvasCoords(struct2.ldInicio);

          ctx.strokeStyle = "#ff9800";
          const lineWidth = Math.max(2, 3 * currentZoom);
          ctx.lineWidth = lineWidth;
          const dashLength = Math.max(8, 12 * currentZoom);
          ctx.setLineDash([dashLength, dashLength/2]);
          ctx.beginPath();
          ctx.moveTo(leInicio1Canvas.x, leInicio1Canvas.y);
          ctx.lineTo(ldInicio2Canvas.x, ldInicio2Canvas.y);
          ctx.stroke();
          ctx.setLineDash([]);

          const midX = (leInicio1Canvas.x + ldInicio2Canvas.x) / 2;
          const midY = (leInicio1Canvas.y + ldInicio2Canvas.y) / 2;
          const crossDistance = calculateDistance(struct1.leInicio, struct2.ldInicio);
          
          const textWidth = 60;
          const textHeight = 20;
          ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
          ctx.fillRect(midX - textWidth/2, midY - textHeight/2, textWidth, textHeight);
          
          ctx.strokeStyle = "#ff9800";
          ctx.lineWidth = 1;
          ctx.strokeRect(midX - textWidth/2, midY - textHeight/2, textWidth, textHeight);
          
          ctx.fillStyle = "#ff9800";
          const crossFontSize = Math.max(10, 12 * currentZoom);
          ctx.font = `bold ${crossFontSize}px Arial`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(`${crossDistance.toFixed(3)}m`, midX, midY);
        }

        showDistanceInfo(struct1, struct2);
      }

      function showDistanceInfo(struct1, struct2) {
        const infoPanel = document.getElementById("infoPanel");
        const distanceInfo = document.getElementById("distanceInfo");

        if (!struct1) return;

        let html = '';

        // C√°lculos estrutura 1
        const dist1Inicio = calculateDistance(struct1.ldInicio, struct1.leInicio);
        const dist1Final = calculateDistance(struct1.ldFinal, struct1.leFinal);
        const dist1LD = calculateDistance(struct1.ldInicio, struct1.ldFinal);
        const dist1LE = calculateDistance(struct1.leInicio, struct1.leFinal);
        const media1Largura = (dist1Inicio + dist1Final) / 2;
        const media1Comprimento = (dist1LD + dist1LE) / 2;

        // AN√ÅLISES DE ELEVA√á√ÉO ESTRUTURA 1
        const elev1_LD_LE_Inicio = calculateElevationDifference(struct1.ldInicio, struct1.leInicio);
        const elev1_LD_LE_Final = calculateElevationDifference(struct1.ldFinal, struct1.leFinal);
        const elev1_Inicio_Final_LD = calculateElevationDifference(struct1.ldInicio, struct1.ldFinal);
        const elev1_Inicio_Final_LE = calculateElevationDifference(struct1.leInicio, struct1.leFinal);

        // INCLINA√á√ïES ESTRUTURA 1
        const incl1_LD_LE_Inicio = calculateInclination(struct1.ldInicio, struct1.leInicio);
        const incl1_LD_LE_Final = calculateInclination(struct1.ldFinal, struct1.leFinal);
        const incl1_Inicio_Final_LD = calculateInclination(struct1.ldInicio, struct1.ldFinal);
        const incl1_Inicio_Final_LE = calculateInclination(struct1.leInicio, struct1.leFinal);

        // Fun√ß√£o para determinar se inclina√ß√µes s√£o problem√°ticas
        function getInclinationStatus(inclination) {
          if (inclination.percentage > 5) return { class: "warning-card", icon: "‚ö†Ô∏è", text: "Alta" };
          else if (inclination.percentage > 2) return { class: "distance-card", icon: "üî∂", text: "Moderada" };
          else return { class: "good-card", icon: "‚úÖ", text: "Boa" };
        }

        // AN√ÅLISE COMPARATIVA PRIMEIRO se tiver 2 estruturas
        if (struct2) {
          const dist2Inicio = calculateDistance(struct2.ldInicio, struct2.leInicio);
          const dist2Final = calculateDistance(struct2.ldFinal, struct2.leFinal);
          const dist2LD = calculateDistance(struct2.ldInicio, struct2.ldFinal);
          const dist2LE = calculateDistance(struct2.leInicio, struct2.leFinal);
          const media2Largura = (dist2Inicio + dist2Final) / 2;
          const media2Comprimento = (dist2LD + dist2LE) / 2;

          // AN√ÅLISES ENTRE ESTRUTURAS
          const crossDistance = calculateDistance(struct1.leInicio, struct2.ldInicio);
          const crossElevation = calculateElevationDifference(struct1.leInicio, struct2.ldInicio);
          const crossInclination = calculateInclination(struct1.leInicio, struct2.ldInicio);
          
          // An√°lises comparativas
          const diferencaLargura = Math.abs(media1Largura - media2Largura);
          const diferencaComprimento = Math.abs(media1Comprimento - media2Comprimento);
          
          // M√©dias gerais entre as duas estruturas
          const mediaGeralLargura = (media1Largura + media2Largura) / 2;
          const mediaGeralComprimento = (media1Comprimento + media2Comprimento) / 2;

          // C√°lculos estrutura 2 para eleva√ß√£o
          const elev2_LD_LE_Inicio = calculateElevationDifference(struct2.ldInicio, struct2.leInicio);
          const elev2_LD_LE_Final = calculateElevationDifference(struct2.ldFinal, struct2.leFinal);
          const elev2_Inicio_Final_LD = calculateElevationDifference(struct2.ldInicio, struct2.ldFinal);
          const elev2_Inicio_Final_LE = calculateElevationDifference(struct2.leInicio, struct2.leFinal);

          const incl2_LD_LE_Inicio = calculateInclination(struct2.ldInicio, struct2.leInicio);
          const incl2_LD_LE_Final = calculateInclination(struct2.ldFinal, struct2.leFinal);
          const incl2_Inicio_Final_LD = calculateInclination(struct2.ldInicio, struct2.ldFinal);
          const incl2_Inicio_Final_LE = calculateInclination(struct2.leInicio, struct2.leFinal);

          // Calcular dist√¢ncias X e Y
          let deltaX = 0;
          let deltaY = 0;
          
          if (struct1.leInicio && struct2.ldInicio) {
            const x1 = parseFloat(struct1.leInicio.x);
            const y1 = parseFloat(struct1.leInicio.y);
            const x2 = parseFloat(struct2.ldInicio.x);
            const y2 = parseFloat(struct2.ldInicio.y);
            
            if (!isNaN(x1) && !isNaN(y1) && !isNaN(x2) && !isNaN(y2)) {
              deltaX = Math.abs(x2 - x1);
              deltaY = Math.abs(y2 - y1);
              
              if ((struct1.leInicio.coordType === 'UTM' && struct2.ldInicio.coordType === 'UTM') || 
                  (struct1.leInicio.coordType === 'PLANE' && struct2.ldInicio.coordType === 'PLANE')) {
                // deltaX e deltaY j√° est√£o em metros
              }
              else if ((struct1.leInicio.coordType === 'GEO' && struct2.ldInicio.coordType === 'GEO') ||
                       (Math.abs(x1) < 180 && Math.abs(y1) < 90 && Math.abs(x2) < 180 && Math.abs(y2) < 90)) {
                const avgLatRad = ((y1 + y2) / 2 * Math.PI) / 180;
                deltaX = deltaX * 111320 * Math.cos(avgLatRad);
                deltaY = deltaY * 111320;
              }
            }
          }
          
          html += `
            <div class="distance-card cross-section">
              <div><strong>üîç AN√ÅLISE COMPARATIVA ENTRE ESTRUTURAS</strong></div>
            </div>
            <div class="distance-card cross-distance-card">
              <div><strong>üåâ Dist√¢ncia Entre Estruturas</strong></div>
              <div class="distance-value cross-distance-value">${crossDistance.toFixed(3)} m</div>
              <small>LE_IN√çCIO (1) ‚Üî LD_IN√çCIO (2)</small>
            </div>
            <div class="distance-card elevation-analysis-card">
              <div><strong>üìè Diferen√ßa de Eleva√ß√£o</strong></div>
              <div class="elevation-value" style="color: ${crossElevation >= 0 ? '#4caf50' : '#f44336'};">${crossElevation >= 0 ? '+' : ''}${crossElevation.toFixed(3)} m</div>
              <small>Entre estruturas (LE1‚ÜíLD2)</small>
            </div>
            <div class="distance-card ${getInclinationStatus(crossInclination).class}">
              <div><strong>${getInclinationStatus(crossInclination).icon} Inclina√ß√£o Entre Estruturas</strong></div>
              <div class="inclination-value">${crossInclination.percentage.toFixed(2)}% (${crossInclination.degrees.toFixed(1)}¬∞)</div>
              <small>${crossInclination.direction} - ${getInclinationStatus(crossInclination).text}</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 2px solid #6c757d;">
              <div><strong>üìê Dist√¢ncia em X</strong></div>
              <div class="distance-value" style="color: #6c757d;">${deltaX.toFixed(3)} m</div>
              <small>Diferen√ßa horizontal</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 2px solid #6c757d;">
              <div><strong>üìê Dist√¢ncia em Y</strong></div>
              <div class="distance-value" style="color: #6c757d;">${deltaY.toFixed(3)} m</div>
              <small>Diferen√ßa vertical</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: 2px solid #9c27b0;">
              <div><strong>üìè M√©dia Geral Largura</strong></div>
              <div class="distance-value" style="color: #9c27b0;">${mediaGeralLargura.toFixed(3)} m</div>
              <small>(Est.1 + Est.2) √∑ 2</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #e8f5e8, #fff3e0); border: 2px solid #ff9800;">
              <div><strong>üìê M√©dia Geral Comprimento</strong></div>
              <div class="distance-value" style="color: #ff9800;">${mediaGeralComprimento.toFixed(3)} m</div>
              <small>(Est.1 + Est.2) √∑ 2</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #ffebee, #f3e5f5); border: 2px solid #e91e63;">
              <div><strong>Diferen√ßa de Larguras</strong></div>
              <div class="distance-value" style="color: #e91e63;">${diferencaLargura.toFixed(3)} m</div>
              <small>|Estrutura 1 - Estrutura 2|</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #e8f5e8, #e0f2f1); border: 2px solid #4caf50;">
              <div><strong>Diferen√ßa de Comprimentos</strong></div>
              <div class="distance-value" style="color: #4caf50;">${diferencaComprimento.toFixed(3)} m</div>
              <small>|Estrutura 1 - Estrutura 2|</small>
            </div>
          `;
        }

        // ESTRUTURA 1 - DIST√ÇNCIAS E ELEVA√á√ïES
        html += `
          <div class="section-divider"></div>
          <div class="distance-card structure-section">
            <div><strong>üèóÔ∏è ESTRUTURA 1 (AZUL) - Dimens√µes</strong></div>
          </div>
          <div class="distance-card">
            <div><strong>Largura In√≠cio</strong></div>
            <div class="distance-value">${dist1Inicio.toFixed(3)} m</div>
            <small>LD_IN√çCIO ‚Üî LE_IN√çCIO</small>
          </div>
          <div class="distance-card">
            <div><strong>Largura Final</strong></div>
            <div class="distance-value">${dist1Final.toFixed(3)} m</div>
            <small>LD_FINAL ‚Üî LE_FINAL</small>
          </div>
          <div class="distance-card" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: 2px solid #9c27b0;">
            <div><strong>üìè M√©dia Largura</strong></div>
            <div class="distance-value" style="color: #9c27b0;">${media1Largura.toFixed(3)} m</div>
            <small>Estrutura 1</small>
          </div>
          <div class="distance-card">
            <div><strong>Comprimento LD</strong></div>
            <div class="distance-value">${dist1LD.toFixed(3)} m</div>
            <small>LD_IN√çCIO ‚Üî LD_FINAL</small>
          </div>
          <div class="distance-card">
            <div><strong>Comprimento LE</strong></div>
            <div class="distance-value">${dist1LE.toFixed(3)} m</div>
            <small>LE_IN√çCIO ‚Üî LE_FINAL</small>
          </div>
          <div class="distance-card" style="background: linear-gradient(135deg, #e8f5e8, #fff3e0); border: 2px solid #ff9800;">
            <div><strong>üìê M√©dia Comprimento</strong></div>
            <div class="distance-value" style="color: #ff9800;">${media1Comprimento.toFixed(3)} m</div>
            <small>Estrutura 1</small>
          </div>
          
          <div class="distance-card elevation-section">
            <div><strong>üìè ESTRUTURA 1 - An√°lise de Eleva√ß√£o</strong></div>
          </div>
          <div class="distance-card elevation-analysis-card">
            <div><strong>Diferen√ßa LD‚ÜîLE (In√≠cio)</strong></div>
            <div class="elevation-value" style="color: ${elev1_LD_LE_Inicio >= 0 ? '#4caf50' : '#f44336'};">${elev1_LD_LE_Inicio >= 0 ? '+' : ''}${elev1_LD_LE_Inicio.toFixed(3)} m</div>
            <small>Inclina√ß√£o transversal in√≠cio</small>
          </div>
          <div class="distance-card elevation-analysis-card">
            <div><strong>Diferen√ßa LD‚ÜîLE (Final)</strong></div>
            <div class="elevation-value" style="color: ${elev1_LD_LE_Final >= 0 ? '#4caf50' : '#f44336'};">${elev1_LD_LE_Final >= 0 ? '+' : ''}${elev1_LD_LE_Final.toFixed(3)} m</div>
            <small>Inclina√ß√£o transversal final</small>
          </div>
          <div class="distance-card elevation-analysis-card">
            <div><strong>Diferen√ßa In√≠cio‚ÜîFinal (LD)</strong></div>
            <div class="elevation-value" style="color: ${elev1_Inicio_Final_LD >= 0 ? '#4caf50' : '#f44336'};">${elev1_Inicio_Final_LD >= 0 ? '+' : ''}${elev1_Inicio_Final_LD.toFixed(3)} m</div>
            <small>Inclina√ß√£o longitudinal LD</small>
          </div>
          <div class="distance-card elevation-analysis-card">
            <div><strong>Diferen√ßa In√≠cio‚ÜîFinal (LE)</strong></div>
            <div class="elevation-value" style="color: ${elev1_Inicio_Final_LE >= 0 ? '#4caf50' : '#f44336'};">${elev1_Inicio_Final_LE >= 0 ? '+' : ''}${elev1_Inicio_Final_LE.toFixed(3)} m</div>
            <small>Inclina√ß√£o longitudinal LE</small>
          </div>
          
          <div class="distance-card elevation-section">
            <div><strong>üìê ESTRUTURA 1 - Inclina√ß√µes</strong></div>
          </div>
          <div class="distance-card ${getInclinationStatus(incl1_LD_LE_Inicio).class}">
            <div><strong>${getInclinationStatus(incl1_LD_LE_Inicio).icon} Inclina√ß√£o LD‚ÜîLE (In√≠cio)</strong></div>
            <div class="inclination-value">${incl1_LD_LE_Inicio.percentage.toFixed(2)}% (${incl1_LD_LE_Inicio.degrees.toFixed(1)}¬∞)</div>
            <small>${incl1_LD_LE_Inicio.direction} - ${getInclinationStatus(incl1_LD_LE_Inicio).text}</small>
          </div>
          <div class="distance-card ${getInclinationStatus(incl1_LD_LE_Final).class}">
            <div><strong>${getInclinationStatus(incl1_LD_LE_Final).icon} Inclina√ß√£o LD‚ÜîLE (Final)</strong></div>
            <div class="inclination-value">${incl1_LD_LE_Final.percentage.toFixed(2)}% (${incl1_LD_LE_Final.degrees.toFixed(1)}¬∞)</div>
            <small>${incl1_LD_LE_Final.direction} - ${getInclinationStatus(incl1_LD_LE_Final).text}</small>
          </div>
          <div class="distance-card ${getInclinationStatus(incl1_Inicio_Final_LD).class}">
            <div><strong>${getInclinationStatus(incl1_Inicio_Final_LD).icon} Inclina√ß√£o In√≠cio‚ÜîFinal (LD)</strong></div>
            <div class="inclination-value">${incl1_Inicio_Final_LD.percentage.toFixed(2)}% (${incl1_Inicio_Final_LD.degrees.toFixed(1)}¬∞)</div>
            <small>${incl1_Inicio_Final_LD.direction} - ${getInclinationStatus(incl1_Inicio_Final_LD).text}</small>
          </div>
          <div class="distance-card ${getInclinationStatus(incl1_Inicio_Final_LE).class}">
            <div><strong>${getInclinationStatus(incl1_Inicio_Final_LE).icon} Inclina√ß√£o In√≠cio‚ÜîFinal (LE)</strong></div>
            <div class="inclination-value">${incl1_Inicio_Final_LE.percentage.toFixed(2)}% (${incl1_Inicio_Final_LE.degrees.toFixed(1)}¬∞)</div>
            <small>${incl1_Inicio_Final_LE.direction} - ${getInclinationStatus(incl1_Inicio_Final_LE).text}</small>
          </div>
        `;

        // ESTRUTURA 2 (se existir)
        if (struct2) {
          const dist2Inicio = calculateDistance(struct2.ldInicio, struct2.leInicio);
          const dist2Final = calculateDistance(struct2.ldFinal, struct2.leFinal);
          const dist2LD = calculateDistance(struct2.ldInicio, struct2.ldFinal);
          const dist2LE = calculateDistance(struct2.leInicio, struct2.leFinal);
          const media2Largura = (dist2Inicio + dist2Final) / 2;
          const media2Comprimento = (dist2LD + dist2LE) / 2;

          const elev2_LD_LE_Inicio = calculateElevationDifference(struct2.ldInicio, struct2.leInicio);
          const elev2_LD_LE_Final = calculateElevationDifference(struct2.ldFinal, struct2.leFinal);
          const elev2_Inicio_Final_LD = calculateElevationDifference(struct2.ldInicio, struct2.ldFinal);
          const elev2_Inicio_Final_LE = calculateElevationDifference(struct2.leInicio, struct2.leFinal);

          const incl2_LD_LE_Inicio = calculateInclination(struct2.ldInicio, struct2.leInicio);
          const incl2_LD_LE_Final = calculateInclination(struct2.ldFinal, struct2.leFinal);
          const incl2_Inicio_Final_LD = calculateInclination(struct2.ldInicio, struct2.ldFinal);
          const incl2_Inicio_Final_LE = calculateInclination(struct2.leInicio, struct2.leFinal);

          html += `
            <div class="section-divider"></div>
            <div class="distance-card structure-section">
              <div><strong>üèóÔ∏è ESTRUTURA 2 (ROSA) - Dimens√µes</strong></div>
            </div>
            <div class="distance-card">
              <div><strong>Largura In√≠cio</strong></div>
              <div class="distance-value">${dist2Inicio.toFixed(3)} m</div>
              <small>LD_IN√çCIO ‚Üî LE_IN√çCIO</small>
            </div>
            <div class="distance-card">
              <div><strong>Largura Final</strong></div>
              <div class="distance-value">${dist2Final.toFixed(3)} m</div>
              <small>LD_FINAL ‚Üî LE_FINAL</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: 2px solid #9c27b0;">
              <div><strong>üìè M√©dia Largura</strong></div>
              <div class="distance-value" style="color: #9c27b0;">${media2Largura.toFixed(3)} m</div>
              <small>Estrutura 2</small>
            </div>
            <div class="distance-card">
              <div><strong>Comprimento LD</strong></div>
              <div class="distance-value">${dist2LD.toFixed(3)} m</div>
              <small>LD_IN√çCIO ‚Üî LD_FINAL</small>
            </div>
            <div class="distance-card">
              <div><strong>Comprimento LE</strong></div>
              <div class="distance-value">${dist2LE.toFixed(3)} m</div>
              <small>LE_IN√çCIO ‚Üî LE_FINAL</small>
            </div>
            <div class="distance-card" style="background: linear-gradient(135deg, #e8f5e8, #fff3e0); border: 2px solid #ff9800;">
              <div><strong>üìê M√©dia Comprimento</strong></div>
              <div class="distance-value" style="color: #ff9800;">${media2Comprimento.toFixed(3)} m</div>
              <small>Estrutura 2</small>
            </div>
            
            <div class="distance-card elevation-section">
              <div><strong>üìè ESTRUTURA 2 - An√°lise de Eleva√ß√£o</strong></div>
            </div>
            <div class="distance-card elevation-analysis-card">
              <div><strong>Diferen√ßa LD‚ÜîLE (In√≠cio)</strong></div>
              <div class="elevation-value" style="color: ${elev2_LD_LE_Inicio >= 0 ? '#4caf50' : '#f44336'};">${elev2_LD_LE_Inicio >= 0 ? '+' : ''}${elev2_LD_LE_Inicio.toFixed(3)} m</div>
              <small>Inclina√ß√£o transversal in√≠cio</small>
            </div>
            <div class="distance-card elevation-analysis-card">
              <div><strong>Diferen√ßa LD‚ÜîLE (Final)</strong></div>
              <div class="elevation-value" style="color: ${elev2_LD_LE_Final >= 0 ? '#4caf50' : '#f44336'};">${elev2_LD_LE_Final >= 0 ? '+' : ''}${elev2_LD_LE_Final.toFixed(3)} m</div>
              <small>Inclina√ß√£o transversal final</small>
            </div>
            <div class="distance-card elevation-analysis-card">
              <div><strong>Diferen√ßa In√≠cio‚ÜîFinal (LD)</strong></div>
              <div class="elevation-value" style="color: ${elev2_Inicio_Final_LD >= 0 ? '#4caf50' : '#f44336'};">${elev2_Inicio_Final_LD >= 0 ? '+' : ''}${elev2_Inicio_Final_LD.toFixed(3)} m</div>
              <small>Inclina√ß√£o longitudinal LD</small>
            </div>
            <div class="distance-card elevation-analysis-card">
              <div><strong>Diferen√ßa In√≠cio‚ÜîFinal (LE)</strong></div>
              <div class="elevation-value" style="color: ${elev2_Inicio_Final_LE >= 0 ? '#4caf50' : '#f44336'};">${elev2_Inicio_Final_LE >= 0 ? '+' : ''}${elev2_Inicio_Final_LE.toFixed(3)} m</div>
              <small>Inclina√ß√£o longitudinal LE</small>
            </div>
            
            <div class="distance-card elevation-section">
              <div><strong>üìê ESTRUTURA 2 - Inclina√ß√µes</strong></div>
            </div>
            <div class="distance-card ${getInclinationStatus(incl2_LD_LE_Inicio).class}">
              <div><strong>${getInclinationStatus(incl2_LD_LE_Inicio).icon} Inclina√ß√£o LD‚ÜîLE (In√≠cio)</strong></div>
              <div class="inclination-value">${incl2_LD_LE_Inicio.percentage.toFixed(2)}% (${incl2_LD_LE_Inicio.degrees.toFixed(1)}¬∞)</div>
              <small>${incl2_LD_LE_Inicio.direction} - ${getInclinationStatus(incl2_LD_LE_Inicio).text}</small>
            </div>
            <div class="distance-card ${getInclinationStatus(incl2_LD_LE_Final).class}">
              <div><strong>${getInclinationStatus(incl2_LD_LE_Final).icon} Inclina√ß√£o LD‚ÜîLE (Final)</strong></div>
              <div class="inclination-value">${incl2_LD_LE_Final.percentage.toFixed(2)}% (${incl2_LD_LE_Final.degrees.toFixed(1)}¬∞)</div>
              <small>${incl2_LD_LE_Final.direction} - ${getInclinationStatus(incl2_LD_LE_Final).text}</small>
            </div>
            <div class="distance-card ${getInclinationStatus(incl2_Inicio_Final_LD).class}">
              <div><strong>${getInclinationStatus(incl2_Inicio_Final_LD).icon} Inclina√ß√£o In√≠cio‚ÜîFinal (LD)</strong></div>
              <div class="inclination-value">${incl2_Inicio_Final_LD.percentage.toFixed(2)}% (${incl2_Inicio_Final_LD.degrees.toFixed(1)}¬∞)</div>
              <small>${incl2_Inicio_Final_LD.direction} - ${getInclinationStatus(incl2_Inicio_Final_LD).text}</small>
            </div>
            <div class="distance-card ${getInclinationStatus(incl2_Inicio_Final_LE).class}">
              <div><strong>${getInclinationStatus(incl2_Inicio_Final_LE).icon} Inclina√ß√£o In√≠cio‚ÜîFinal (LE)</strong></div>
              <div class="inclination-value">${incl2_Inicio_Final_LE.percentage.toFixed(2)}% (${incl2_Inicio_Final_LE.degrees.toFixed(1)}¬∞)</div>
              <small>${incl2_Inicio_Final_LE.direction} - ${getInclinationStatus(incl2_Inicio_Final_LE).text}</small>
            </div>
          `;
        }

        distanceInfo.innerHTML = html;
        
        // Adicionar resumo executivo
        if (struct2) {
          const dist2Inicio = calculateDistance(struct2.ldInicio, struct2.leInicio);
          const dist2Final = calculateDistance(struct2.ldFinal, struct2.leFinal);
          const dist2LD = calculateDistance(struct2.ldInicio, struct2.ldFinal);
          const dist2LE = calculateDistance(struct2.leInicio, struct2.leFinal);
          const media2Largura = (dist2Inicio + dist2Final) / 2;
          const media2Comprimento = (dist2LD + dist2LE) / 2;

          const elev2_LD_LE_Inicio = calculateElevationDifference(struct2.ldInicio, struct2.leInicio);
          const elev2_LD_LE_Final = calculateElevationDifference(struct2.ldFinal, struct2.leFinal);
          const elev2_Inicio_Final_LD = calculateElevationDifference(struct2.ldInicio, struct2.ldFinal);
          const elev2_Inicio_Final_LE = calculateElevationDifference(struct2.leInicio, struct2.leFinal);

          const incl2_LD_LE_Inicio = calculateInclination(struct2.ldInicio, struct2.leInicio);
          const incl2_LD_LE_Final = calculateInclination(struct2.ldFinal, struct2.leFinal);
          const incl2_Inicio_Final_LD = calculateInclination(struct2.ldInicio, struct2.ldFinal);
          const incl2_Inicio_Final_LE = calculateInclination(struct2.leInicio, struct2.leFinal);

          const crossDistance = calculateDistance(struct1.leInicio, struct2.ldInicio);
          const crossElevation = calculateElevationDifference(struct1.leInicio, struct2.ldInicio);
          const crossInclination = calculateInclination(struct1.leInicio, struct2.ldInicio);
          const mediaGeralLargura = (media1Largura + media2Largura) / 2;
          const mediaGeralComprimento = (media1Comprimento + media2Comprimento) / 2;
          
          // Verificar problemas de inclina√ß√£o
          const problemasInclinacao = [];
          if (incl1_LD_LE_Inicio.percentage > 5) problemasInclinacao.push("Est.1 LD‚ÜîLE in√≠cio");
          if (incl1_LD_LE_Final.percentage > 5) problemasInclinacao.push("Est.1 LD‚ÜîLE final");
          if (incl1_Inicio_Final_LD.percentage > 5) problemasInclinacao.push("Est.1 LD longitudinal");
          if (incl1_Inicio_Final_LE.percentage > 5) problemasInclinacao.push("Est.1 LE longitudinal");
          if (incl2_LD_LE_Inicio.percentage > 5) problemasInclinacao.push("Est.2 LD‚ÜîLE in√≠cio");
          if (incl2_LD_LE_Final.percentage > 5) problemasInclinacao.push("Est.2 LD‚ÜîLE final");
          if (incl2_Inicio_Final_LD.percentage > 5) problemasInclinacao.push("Est.2 LD longitudinal");
          if (incl2_Inicio_Final_LE.percentage > 5) problemasInclinacao.push("Est.2 LE longitudinal");
          if (crossInclination.percentage > 5) problemasInclinacao.push("Entre estruturas");
          
          const summaryHtml = `
            <h4 style="margin-bottom: 15px; color: #495057;">üìã Resumo Executivo - An√°lise Completa</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; text-align: center;">
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: #007bff;">üåâ Dist√¢ncia Total</div>
                <div style="font-size: 16px; font-weight: bold; color: #007bff; margin: 5px 0;">${crossDistance.toFixed(3)}m</div>
                <div style="font-size: 12px; color: #6c757d;">LE(1) ‚Üî LD(2)</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: ${crossElevation >= 0 ? '#4caf50' : '#f44336'};">üìè Diferen√ßa Eleva√ß√£o</div>
                <div style="font-size: 16px; font-weight: bold; color: ${crossElevation >= 0 ? '#4caf50' : '#f44336'}; margin: 5px 0;">${crossElevation >= 0 ? '+' : ''}${crossElevation.toFixed(3)}m</div>
                <div style="font-size: 12px; color: #6c757d;">Entre estruturas</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: ${crossInclination.percentage > 5 ? '#f44336' : crossInclination.percentage > 2 ? '#ff9800' : '#4caf50'};">üìê Inclina√ß√£o</div>
                <div style="font-size: 16px; font-weight: bold; color: ${crossInclination.percentage > 5 ? '#f44336' : crossInclination.percentage > 2 ? '#ff9800' : '#4caf50'}; margin: 5px 0;">${crossInclination.percentage.toFixed(2)}%</div>
                <div style="font-size: 12px; color: #6c757d;">Entre estruturas</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: #9c27b0;">üìè Largura M√©dia</div>
                <div style="font-size: 16px; font-weight: bold; color: #9c27b0; margin: 5px 0;">${mediaGeralLargura.toFixed(3)}m</div>
                <div style="font-size: 12px; color: #6c757d;">Geral (Est.1+2)</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: #ff9800;">üìê Comprimento M√©dio</div>
                <div style="font-size: 16px; font-weight: bold; color: #ff9800; margin: 5px 0;">${mediaGeralComprimento.toFixed(3)}m</div>
                <div style="font-size: 12px; color: #6c757d;">Geral (Est.1+2)</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid ${problemasInclinacao.length > 0 ? '#f44336' : '#4caf50'};">
                <div style="font-weight: bold; color: ${problemasInclinacao.length > 0 ? '#f44336' : '#4caf50'};">${problemasInclinacao.length > 0 ? '‚ö†Ô∏è' : '‚úÖ'} Status Inclina√ß√£o</div>
                <div style="font-size: 16px; font-weight: bold; color: ${problemasInclinacao.length > 0 ? '#f44336' : '#4caf50'}; margin: 5px 0;">${problemasInclinacao.length > 0 ? `${problemasInclinacao.length} Problemas` : 'Dentro do Normal'}</div>
                <div style="font-size: 12px; color: #6c757d;">${problemasInclinacao.length > 0 ? 'Verificar inclina√ß√µes' : 'Todas inclina√ß√µes OK'}</div>
              </div>
            </div>
            ${problemasInclinacao.length > 0 ? `
            <div style="margin-top: 15px; padding: 12px; background: #fff3e0; border: 2px solid #ff9800; border-radius: 6px;">
              <div style="font-weight: bold; color: #f57c00; margin-bottom: 8px;">‚ö†Ô∏è Inclina√ß√µes Altas Detectadas (>5%):</div>
              <div style="font-size: 14px; color: #ef6c00;">${problemasInclinacao.join(', ')}</div>
              <div style="font-size: 12px; color: #f57c00; margin-top: 5px;">Recomenda-se verifica√ß√£o estrutural para inclina√ß√µes > 5%</div>
            </div>
            ` : ''}
          `;
          document.getElementById('executiveSummary').innerHTML = summaryHtml;
        } else {
          const summaryHtml = `
            <h4 style="margin-bottom: 15px; color: #495057;">üìã Resumo Executivo - Estrutura √önica</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; text-align: center;">
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: #9c27b0;">üìè Largura M√©dia</div>
                <div style="font-size: 18px; font-weight: bold; color: #9c27b0; margin: 5px 0;">${media1Largura.toFixed(3)} m</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: #ff9800;">üìê Comprimento M√©dio</div>
                <div style="font-size: 18px; font-weight: bold; color: #ff9800; margin: 5px 0;">${media1Comprimento.toFixed(3)} m</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: ${incl1_LD_LE_Inicio.percentage > 5 || incl1_LD_LE_Final.percentage > 5 ? '#f44336' : '#4caf50'};">üìê Status Transversal</div>
                <div style="font-size: 14px; font-weight: bold; color: ${incl1_LD_LE_Inicio.percentage > 5 || incl1_LD_LE_Final.percentage > 5 ? '#f44336' : '#4caf50'}; margin: 5px 0;">${incl1_LD_LE_Inicio.percentage > 5 || incl1_LD_LE_Final.percentage > 5 ? 'Aten√ß√£o' : 'OK'}</div>
                <div style="font-size: 12px; color: #6c757d;">Inclina√ß√£o LD‚ÜîLE</div>
              </div>
              <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #dee2e6;">
                <div style="font-weight: bold; color: ${incl1_Inicio_Final_LD.percentage > 5 || incl1_Inicio_Final_LE.percentage > 5 ? '#f44336' : '#4caf50'};">üìê Status Longitudinal</div>
                <div style="font-size: 14px; font-weight: bold; color: ${incl1_Inicio_Final_LD.percentage > 5 || incl1_Inicio_Final_LE.percentage > 5 ? '#f44336' : '#4caf50'}; margin: 5px 0;">${incl1_Inicio_Final_LD.percentage > 5 || incl1_Inicio_Final_LE.percentage > 5 ? 'Aten√ß√£o' : 'OK'}</div>
                <div style="font-size: 12px; color: #6c757d;">Inclina√ß√£o In√≠cio‚ÜîFinal</div>
              </div>
            </div>
          `;
          document.getElementById('executiveSummary').innerHTML = summaryHtml;
        }
        
        infoPanel.style.display = "block";
      }

      function processData() {
        const csvData1 = document.getElementById("csvData1").value;
        const csvData2 = document.getElementById("csvData2").value;
        const errorMsg = document.getElementById("errorMsg");
        errorMsg.innerHTML = "";

        if (!csvData1.trim()) {
          errorMsg.innerHTML = '<div class="error">‚ö†Ô∏è Por favor, cole pelo menos os dados do CSV 1!</div>';
          return;
        }

        try {
          const data1 = parseCSV(csvData1);
          const data2 = parseCSV(csvData2);

          const points1 = findPoints(data1);
          const points2 = findPoints(data2);
          
          currentPoints1 = points1;
          currentPoints2 = points2;

          if (Object.keys(points1).length === 0) {
            errorMsg.innerHTML = '<div class="error">‚ö†Ô∏è Nenhum ponto LD ou LE encontrado no CSV 1!</div>';
            return;
          }

          drawVisualization(points1, points2);
        } catch (error) {
          console.error("Erro:", error);
          errorMsg.innerHTML = `<div class="error">‚ùå Erro ao processar dados: ${error.message}</div>`;
        }
      }

      // Pr√©-carregar dados de exemplo
      window.onload = function () {
        updateZoomDisplay(); // Atualizar display do zoom para 200%
        loadExample1();
      };
    </script>
  </body>
</html>
